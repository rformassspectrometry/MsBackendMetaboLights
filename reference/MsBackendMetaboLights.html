<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>MsBackend representing MS data from MetaboLights — MsBackendMetaboLights • MsBackendMetaboLights</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="MsBackend representing MS data from MetaboLights — MsBackendMetaboLights"><meta name="description" content="MsBackendMetaboLights retrieves and represents mass spectrometry (MS)
data from metabolomics experiments stored in the
MetaboLights repository. The backend
directly extends the Spectra::MsBackendMzR backend from the Spectra
package and hence supports MS data in mzML, netCDF and mzXML format. Data
in other formats can not be loaded with MsBackendMetaboLights.
Upon initialization with the backendInitialize() method, the
MsBackendMetaboLights backend downloads and caches the MS data files of
an experiment locally avoiding hence repeated download of the data."><meta property="og:description" content="MsBackendMetaboLights retrieves and represents mass spectrometry (MS)
data from metabolomics experiments stored in the
MetaboLights repository. The backend
directly extends the Spectra::MsBackendMzR backend from the Spectra
package and hence supports MS data in mzML, netCDF and mzXML format. Data
in other formats can not be loaded with MsBackendMetaboLights.
Upon initialization with the backendInitialize() method, the
MsBackendMetaboLights backend downloads and caches the MS data files of
an experiment locally avoiding hence repeated download of the data."><meta property="og:image" content="https://rformassspectrometry.github.io/MsBackendMetaboLights/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MsBackendMetaboLights</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/MsBackendMetaboLights.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RforMassSpectrometry/MsBackendMetaboLights/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>MsBackend representing MS data from MetaboLights</h1>
      <small class="dont-index">Source: <a href="https://github.com/RforMassSpectrometry/MsBackendMetaboLights/blob/main/R/MsBackendMetaboLights.R" class="external-link"><code>R/MsBackendMetaboLights.R</code></a></small>
      <div class="d-none name"><code>MsBackendMetaboLights.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>MsBackendMetaboLights</code> retrieves and represents mass spectrometry (MS)
data from metabolomics experiments stored in the
<a href="https://www.ebi.ac.uk/metabolights/" class="external-link">MetaboLights</a> repository. The backend
directly extends the <a href="https://rdrr.io/pkg/Spectra/man/MsBackend.html" class="external-link">Spectra::MsBackendMzR</a> backend from the <em>Spectra</em>
package and hence supports MS data in mzML, netCDF and mzXML format. Data
in other formats can not be loaded with <code>MsBackendMetaboLights</code>.
Upon initialization with the <code>backendInitialize()</code> method, the
<code>MsBackendMetaboLights</code> backend downloads and caches the MS data files of
an experiment locally avoiding hence repeated download of the data.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">MsBackendMetaboLights</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'MsBackendMetaboLights'</span></span>
<span><span class="fu">backendInitialize</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  mtblsId <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  assayName <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  filePattern <span class="op">=</span> <span class="st">"mzML$|CDF$|cdf$|mzXML$"</span>,</span>
<span>  offline <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'MsBackendMetaboLights'</span></span>
<span><span class="fu">backendMerge</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'MsBackendMetaboLights'</span></span>
<span><span class="fu">backendRequiredSpectraVariables</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mtbls_sync</span><span class="op">(</span><span class="va">x</span>, offline <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>an instance of <code>MsBackendMetaboLights</code>.</p></dd>


<dt id="arg-mtblsid">mtblsId<a class="anchor" aria-label="anchor" href="#arg-mtblsid"></a></dt>
<dd><p><code>character(1)</code> with the ID of a single MetaboLights data
set/experiment.</p></dd>


<dt id="arg-assayname">assayName<a class="anchor" aria-label="anchor" href="#arg-assayname"></a></dt>
<dd><p><code>character</code> with the file names of assay files of the data
set. If not provided (<code>assayName = character()</code>, the default), MS data
files of all data set's assays are loaded. Use
<code>mtbls_list_files(&lt;MetaboLights ID&gt;, pattern = "^a_")</code> to list all
available assay files of a data set <code>&lt;MetaboLights ID&gt;</code>.</p></dd>


<dt id="arg-filepattern">filePattern<a class="anchor" aria-label="anchor" href="#arg-filepattern"></a></dt>
<dd><p><code>character</code> with the pattern defining the supported (or
requested) file types. Defaults to
<code>filePattern = "mzML$|CDF$|cdf$|mzXML$"</code> hence restricting to mzML,
CDF and mzXML files which are supported by <em>Spectra</em>'s
<code>MsBackendMzR</code> backend.</p></dd>


<dt id="arg-offline">offline<a class="anchor" aria-label="anchor" href="#arg-offline"></a></dt>
<dd><p><code>logical(1)</code> whether only locally cached content should be
evaluated/loaded.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>additional parameters; currently ignored.</p></dd>


<dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>an instance of <code>MsBackendMetaboLights</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>

<ul><li><p>For <code>MsBackendMetaboLights()</code>: an instance of <code>MsBackendMetaboLights</code>.</p></li>
<li><p>For <code><a href="https://rdrr.io/pkg/ProtGenerics/man/backendInitialize.html" class="external-link">backendInitialize()</a></code>: an instance of <code>MsBackendMetaboLights</code> with
the MS data of the specified MetaboLights data set.</p></li>
<li><p>For <code><a href="https://rdrr.io/pkg/Spectra/man/MsBackend.html" class="external-link">backendRequiredSpectraVariables()</a></code>: <code>character</code> with spectra
variables that are needed for the backend to provide the MS data.</p></li>
<li><p>For <code>mtbls_sync()</code>: the input <code>MsBackendMetaboLights</code> with the paths to
the locally cached data files being eventually updated.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>File names for data files are by default extracted from the column
<code>"Derived Spectral Data File"</code> of the MetaboLights data set's <em>assay</em>
table. If this column does not contain any supported file names, the
assay's column <code>"Raw Spectral Data File"</code> is evaluated instead.</p>
<p>The backend uses the
<a href="https://bioconductor.org/packages/BiocFileCache" class="external-link">BiocFileCache</a> package for
caching of the data files. These are stored in the default local
<em>BiocFileCache</em> cache along with additional metadata that includes the
MetaboLights ID and the assay file name with which the data file is
associated with. Note that at present only MS data files in <em>mzML</em>, <em>CDF</em>
and <em>mzXML</em> format are supported.</p>
<p>The <code>MsBackendMetaboLights</code> backend defines and provides additional spectra
variables <code>"mtbls_id"</code>, <code>"mtbls_assay_name"</code> and
<code>"derived_spectral_data_file"</code> that list the MetaboLights ID, the name of
the assay file and the original data file name on the MetaboLights ftp
server for each individual spectrum. The <code>"derived_spectral_data_file"</code> can
be used for the mapping between the experiment's samples and the
individual data files, respective their spectra. This mapping is provided
in the MetaboLights assay file.</p>
<p>The <code>MsBackendMetaboLights</code> backend is considered <em>read-only</em> and does
thus not support changing <em>m/z</em> and intensity values directly.</p>
<p>Also, merging of MS data of <code>MsBackendMetaboLights</code> is not supported and
thus <code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code> of several <code>Spectra</code> with MS data represented by
<code>MsBackendMetaboLights</code> will throw an error.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>To account for high server load and eventually failing or rejected
downloads from the MetaboLights ftp server, the download functions
repeatedly retry to download a file. An error is thrown if download fails
for 3 consecutive attempts. Between each attemp, the function waits
for an increasing time period (5 seconds between the first and second
and 10 seconds between the 2nd and 3rd attempt). This time period can
also be configured with the <code>"metabolights.sleep_mult"</code> option, which
defines the <em>sleep time multiplicator</em> (defaults to 5).</p>
    </div>
    <div class="section level2">
    <h2 id="initialization-and-loading-of-data">Initialization and loading of data<a class="anchor" aria-label="anchor" href="#initialization-and-loading-of-data"></a></h2>



<p>New instances of the class can be created with the <code>MsBackendMetaboLights()</code>
function. Data is loaded and initialized using the <code><a href="https://rdrr.io/pkg/ProtGenerics/man/backendInitialize.html" class="external-link">backendInitialize()</a></code>
function which can be configured with parameters <code>mtblsId</code>, <code>assayName</code> and
<code>filePattern</code>. <code>mtblsId</code> must be the ID of a <strong>single</strong> (existing)
MetaboLights data set. Parameter <code>assayName</code> allows to define specific
<em>assays</em> of the MetaboLights data set from which the data files should be
loaded. If provided, it should be the file name(s) of the respective
assay(s) in MetaboLights (use e.g.
<code>mtbls_list_files(&lt;MetaboLights ID&gt;, pattern = "^a_")</code> to list all available
assay files for a given MetaboLights ID <code>&lt;MetaboLights ID&gt;</code>). By default,
with <code>assayName = character()</code> MS data files from <strong>all</strong> assays of a data
set are loaded. Optional parameter <code>filePattern</code> defines the pattern that
should be used to filter the file names of the MS data files. It defaults
to data files with file endings of supported MS data files.
<code><a href="https://rdrr.io/pkg/ProtGenerics/man/backendInitialize.html" class="external-link">backendInitialize()</a></code> requires an active internet connection as the
function first compares the remote file content to the locally cached files
and eventually synchronizes changes/updates. This can be skipped with
<code>offline = TRUE</code> in which case only locally cached content is queried.</p>
<p>The <code><a href="https://rdrr.io/pkg/Spectra/man/MsBackend.html" class="external-link">backendRequiredSpectraVariables()</a></code> function returns the names of the
spectra variables required for the backend to provide the MS data.</p>
<p>The <code>mtbls_sync()</code> function can be used to <em>synchronize</em> the local data
cache and ensure that all data files are locally available. The function
will check the local cache and eventually download missing data files from
the MetaboLights repository.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Philippine Louail, Johannes Rainer</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/MsBackendMetaboLights" class="external-link">MsBackendMetaboLights</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## List files of a MetaboLights data set</span></span></span>
<span class="r-in"><span><span class="fu"><a href="MetaboLights-utils.html">mtbls_list_files</a></span><span class="op">(</span><span class="st">"MTBLS39"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "FILES"                                                                                                          </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2] "a_MTBLS39_the_plasticity_of_the_grapevine_berry_transcriptome_metabolite_profiling_mass_spectrometry.txt"       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3] "i_Investigation.txt"                                                                                            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4] "m_MTBLS39_the_plasticity_of_the_grapevine_berry_transcriptome_metabolite_profiling_mass_spectrometry_v2_maf.tsv"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5] "metexplore_mapping.json"                                                                                        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6] "s_MTBLS39.txt"                                                                                                  </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Initialize a MsBackendMetaboLights representing all MS data files of</span></span></span>
<span class="r-in"><span><span class="co">## the data set with the ID "MTBLS39". This will download and cache all</span></span></span>
<span class="r-in"><span><span class="co">## files and subsequently load and represent them in R.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">be</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/backendInitialize.html" class="external-link">backendInitialize</a></span><span class="op">(</span><span class="fu">MsBackendMetaboLights</span><span class="op">(</span><span class="op">)</span>, <span class="st">"MTBLS39"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Used data files from the assay's column "Raw Spectral Data File" since none were available in column "Derived Spectral Data File".</span>
<span class="r-in"><span><span class="va">be</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MsBackendMetaboLights with 15141 spectra</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1             1  0.296384         1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2             1  6.206912         2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3             1 12.093056         3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4             1 17.942912         4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5             1 23.835072         5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ...         ...       ...       ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15137         1   2682.81       596</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15138         1   2687.29       597</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15139         1   2691.77       598</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15140         1   2696.27       599</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15141         1   2700.81       600</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 36 more variables/columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> file(s):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MN063A.cdf</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MN063B.cdf</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MN063C.cdf</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 24 more files</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The `mtbls_sync()` function can be used to ensure that all data files are</span></span></span>
<span class="r-in"><span><span class="co">## available locally. This function will eventually download missing data</span></span></span>
<span class="r-in"><span><span class="co">## files or update their paths.</span></span></span>
<span class="r-in"><span><span class="va">be</span> <span class="op">&lt;-</span> <span class="fu">mtbls_sync</span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Used data files from the assay's column "Raw Spectral Data File" since none were available in column "Derived Spectral Data File".</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Johannes Rainer, Philippine Louail.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer></div>





  </body></html>

